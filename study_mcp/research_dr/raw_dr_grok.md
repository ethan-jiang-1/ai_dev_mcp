# 大型语言模型代理的模型上下文协议 (MCP) 综合调研报告

## 执行摘要

模型上下文协议 (MCP) 由 Anthropic 于 2024 年 11 月推出，代表了在标准化大型语言模型 (LLM) 代理与外部工具、数据源和其他代理之间交互方面的一项关键进展。MCP 定位为一种通用的、开放标准的协议，通过提供一个基于 JSON-RPC 的框架用于工具调用、上下文共享和代理互操作性，解决了 LLM 生态系统中的碎片化问题。本报告对 MCP 进行了深入分析，探讨了其技术基础、通信机制、安全模型、可伸缩性、互操作性和实际应用。通过从多个维度——协议架构、交互模式、语义理解、安全性、信任、服务质量 (QoS) 和生态系统采用——审视 MCP，本报告旨在对其功能、局限性和对未来基于 LLM 的多代理系统 (MAS) 的潜在影响提供一个全面的理解。该分析借鉴了最新的文献、技术文档和社区讨论，以提供一个严谨和批判性的视角。

## 1. 引言

大型语言模型 (LLM) 通过在从软件开发到业务自动化的不同领域实现复杂的推理、规划和任务执行，改变了人工智能。然而，随着 LLM 驱动的代理成为复杂工作流程中不可或缺的一部分，缺乏用于将这些代理与外部系统集成的标准化协议已成为一个重大的瓶颈。临时集成是脆弱的、特定于供应商的且难以扩展，从而导致效率低下和安全风险。模型上下文协议 (MCP) 的引入旨在解决这些挑战，提供一个与模型无关的、开放标准的框架，用于将 LLM 连接到工具、数据源和其他代理。

MCP 通常被称为“人工智能应用的 USB-C”，旨在简化上下文获取、工具调用和代理间通信。自发布以来，MCP 已获得广泛关注，已被 OpenAI、Google DeepMind、微软等主要参与者采用，并且到 2025 年 5 月，其生态系统已拥有超过 5,000 个活跃的 MCP 服务器。本报告综合了来自最新研究、行业发展和开源贡献的见解，对 MCP 的设计、实施和影响进行了全面分析。该分析围绕关键维度构建，包括协议基础、交互模式、语义理解、安全性、信任、QoS、互操作性和生态系统动态，并额外关注性能、可伸缩性和特定领域应用。

## 2. 协议基础和核心要素

### 2.1 层和传输协议

MCP 建立在客户端-服务器架构之上，利用 JSON-RPC 2.0 作为其主要传输机制。JSON-RPC 提供了一种轻量级、无状态且与语言无关的远程过程调用协议，使其非常适合 LLM 代理交互。最初，MCP 依赖于标准的基于 HTTP 的 JSON-RPC，但到 2025 年初，它演变为包含 HTTP 服务器发送事件 (SSE) 以实现实时流式传输和异步通信，从而满足了代理工作流程中对动态、低延迟交互的需求。

最近的发展表明，MCP 正在探索对其他传输层的支持，例如用于双向通信的 WebSocket 和用于高性能、低延迟场景的 gRPC。WebSocket 对于实时应用尤其重要，例如需要持续更新的交互式桌面助手或多代理系统。gRPC 凭借其对 Protobuf 序列化的支持，在性能和类型安全方面具有优势，使其适用于具有严格延迟要求的企业级部署。然而，截至 2025 年 6 月，由于其简单性和广泛采用，基于 HTTP/SSE 的 JSON-RPC 仍然是主要的传输机制。

### 2.2 序列化格式

MCP 主要使用 JSON 进行消息序列化，这符合 JSON-RPC 的要求。JSON 的人类可读格式和广泛的兼容性使其成为跨不同平台和编程语言实现互操作性的理想选择。然而，JSON 的冗长性可能会在吞吐量较高的场景中引入开销。为了解决这个问题，一些 MCP 实现（例如 AgentD）已经引入了对 Protobuf (Protocol Buffers) 的支持，用于结构化请求和响应，尤其是在基于 gRPC 的部署中。Protobuf 提供了紧凑的序列化和类型安全，这对于大规模、性能敏感的应用程序至关重要。

选择 JSON 作为默认序列化格式反映了 MCP 对开发人员可访问性和生态系统兼容性的重视。然而，在某些实现中包含 Protobuf 表明了一种前瞻性的方法，以应对多代理系统中的可伸缩性和性能挑战。

### 2.3 代理识别和消息结构

MCP 为代理采用唯一的标识符系统，通常基于 UUID（通用唯一标识符），以确保在多代理环境中的明确寻址。每个代理都与一个会话 ID 相关联，该 ID 用于跟踪交互并在多个交换中维护状态。MCP 中的消息结构包括以下关键字段：

- **会话 ID**：标识特定交互会话的 UUID。
- **发送者 ID**：发送代理或客户端的唯一标识符。
- **接收者 ID**：目标代理、工具或资源的标识符（对于广播消息可以设置为“all”）。
- **内容**：有效负载，可以包括自然语言、结构化数据（例如 JSON 对象）或工具调用指令。
- **类型**：指定消息类型（例如，请求、响应、通知）。
- **时间戳**：记录消息创建时间以进行审计和排序。
- **元数据**：用于附加上下文的可选键值对，例如工具功能或会话参数。

这种结构借鉴了早期的代理通信标准，如 FIPA-ACL，后者定义了基于施为语的消息格式，包含发送者、接收者和意图等字段。然而，MCP 简化了 FIPA-ACL 冗长的基于 XML 的编码，选择了轻量级的 JSON 来提高性能和开发人员的采用率。

### 2.4 通信语言 (ACL)

MCP 的通信语言受到 FIPA-ACL 的启发，FIPA-ACL 引入了通信行为（施为语）的概念来表达代理意图，例如请求、通知、提议、同意和拒绝。MCP 采用了类似的方法，但简化了施为语集合，以专注于实用的、以 LLM 为中心的交互。MCP 中常见的施为语包括：

- **请求 (Request)**：启动工具调用或数据检索。
- **通知 (Inform)**：与其他代理共享上下文或结果。
- **通知 (Notify)**：发出事件或更新信号，通常用于基于订阅的工作流程。
- **错误 (Error)**：报告处理过程中的故障或异常。

与 FIPA-ACL 严重依赖形式化语义模型（例如 SL0、SL1 内容语言）不同，MCP 优先考虑灵活性，允许代理使用自然语言或结构化 JSON 有效负载表达意图。这种混合方法既适应了 LLM 驱动的自然语言理解，也适应了结构化数据交换，使 MCP 能够灵活地用于各种用例。

### 2.5 内容语言

MCP 支持多种内容语言以适应不同的用例。主要的内容语言是：

- **自然语言**：用于利用 LLM 自然语言处理功能的提示、查询或响应。例如，用户查询“总结 README.md 的内容”将被处理为自然语言有效负载。
- **结构化数据**：定义工具参数、预期输出或数据模式的 JSON 对象或 Protobuf 消息。例如，工具调用可能包含一个指定 {"query": "SELECT * FROM users", "database": "postgres"} 的 JSON 有效负载。
- **提示模板**：指导 LLM 推理的预定义模板，例如“使用 {tool} 分析 {query}”。这些模板通常存储在 MCP 服务器上，并动态注入到代理工作流程中。

MCP 内容语言的灵活性使其能够与面向人类的应用程序（例如对话代理）和以机器为中心的工作流程（例如数据库查询、API 调用）无缝集成。

## 3. 交互模式和会话管理

### 3.1 通信模式

MCP 支持多种通信模式以适应不同的代理交互模式：

- **点对点**：客户端（例如 LLM 代理）和服务器（例如工具或数据源）之间的直接通信。这是工具调用最常见的模式，例如查询数据库或获取文件。
- **广播/多播**：通过将接收者 ID 设置为“all”或组标识符，可以将消息发送到多个代理或工具。这对于通知多个代理状态更改或事件非常有用。
- **发布/订阅**：MCP 利用 HTTP SSE 进行异步事件驱动通信，允许代理订阅资源更新（例如文件更改、数据库修改）。此模式对于桌面助手或协作工作流程等实时应用程序至关重要。
- **代理中介**：在复杂的多代理系统中，MCP 可以与代理（例如协调器代理）集成以路由消息和管理交互。这在企业环境中很常见，其中中央协调器将任务委派给专门的代理。

这些模式使 MCP 能够支持从简单的工具调用到复杂的多代理协调等广泛的用例。

### 3.2 交互协议

MCP 定义了受 FIPA-ACL 模式启发的轻量级交互协议，例如：

- **请求-响应**：最常见的模式，其中代理向工具或其他代理发送请求并等待响应。例如，LLM 代理可能会请求 GitHub API 调用以创建问题。
- **合同网协议**：用于任务委派，其中协调器代理向多个工作代理征求投标，并根据能力或可用性分配任务。
- **订阅/通知**：代理订阅特定资源（例如文件或数据库），并在发生更改时接收通知。这是使用 SSE 或 WebSocket 实现的实时更新。
- **协商**：虽然不太常见，但 MCP 支持协商工作流程，其中代理利用自然语言或结构化有效负载来表达意图，从而提议、反提议或就行动达成一致。

这些协议并非严格执行，允许开发人员根据应用程序需求自定义交互流程。这种灵活性与 FIPA-ACL 的严格语义形成对比，使 MCP 更能适应现代 LLM 驱动的工作流程。

### 3.3 会话管理

MCP 使用会话 ID 来跟踪和管理正在进行的交互，确保在多轮对话中进行有状态的通信。会话管理的主要功能包括：

- **状态持久性**：MCP 服务器维护对话状态，包括消息历史记录和上下文，允许代理无缝恢复交互。
- **错误处理**：MCP 定义标准错误消息（例如，未找到对话，工具不可用）以优雅地处理异常。
- **超时和恢复**：可以为会话配置超时以防止资源耗尽，并且恢复机制允许代理重试失败的请求。
- **会话组合**：复杂的工作流程可以组合多个会话，从而实现扇出/扇入模式，其中子任务被委派给多个代理并聚合结果。

会话管理在 AgentD 等框架中尤其强大，该框架使用 gRPC 处理会话初始化、上下文加载和跨代理的状态同步。

## 4. 语义理解和代理发现

### 4.1 本体和知识共享

语义一致性对于有效的代理通信至关重要。MCP 通过允许代理共享结构化上下文（例如 JSON 模式、工具元数据）和定义预期输入和输出的提示模板来解决此问题。与依赖形式化本体（例如 SL0、SL1）的 FIPA-ACL 不同，MCP 采用务实的方法，利用 LLM 的自然语言理解来解释意图和有效负载。这降低了本体管理的复杂性，使 MCP 更易于开发人员使用。

然而，缺乏形式化本体可能会导致异构系统中的语义模糊性。为了缓解这种情况，MCP 通过 JSON-LD（JSON for Linked Data）支持可选的本体集成，使代理能够引用共享词汇表或特定领域模式。例如，查询 PubMed 的研究代理可能会使用 JSON-LD 模式来标准化医学术语。

### 4.2 代理发现

MCP 通过目录和注册中心促进代理发现，例如 Glama 的 MCP 服务器目录，截至 2025 年 5 月，该目录列出了 5,000 多个活动服务器。这些目录提供有关可用代理和工具的元数据，包括：

- **功能**：支持的工具、资源或服务的描述。
- **身份验证要求**：基于 OAuth 2.0/2.1 或 JWT 的身份验证详细信息。
- **信任信号**：诸如“官方”或“已验证”状态之类的指示符，尽管这些指示符并非总是可靠的。

发现机制包括：

- **本地发现**：使用 mDNS（多播 DNS）发现在本地网络上的代理，适用于边缘部署。
- **集中式注册中心**：根据功能元数据索引 MCP 服务器的公共或私有注册中心。
- **去中心化发现**：ANP 等协议中对去中心化标识符 (DID) 的新兴支持，MCP 可能会在开放网络场景中采用这种支持。

集中式和去中心化发现机制的结合增强了 MCP 的灵活性，使其能够在受控的企业环境和开放的生态系统中运行。

## 5. 安全、信任和服务质量 (QoS)

### 5.1 安全机制

鉴于执行任意代码或访问敏感数据相关的风险，安全性是 MCP 设计的基石。关键安全功能包括：

- **身份验证**：MCP 使用 OAuth 2.0/2.1 和 PKCE（代码交换证明密钥）来验证代理和客户端。这确保只有授权实体才能访问工具或资源。
- **授权**：基于角色的访问控制 (RBAC) 和细粒度权限根据代理角色或会话范围限制工具访问。
- **加密**：HTTPS 和 TLS 确保传输过程中的消息机密性和完整性。
- **沙盒化**：鼓励 MCP 服务器在沙盒环境中运行工具，以防止恶意代码执行。
- **提示注入防御**：MCP 客户端对工具输入和参数进行清理，以防止提示注入攻击，这是 LLM 系统中的常见漏洞。

尽管采取了这些措施，但安全挑战依然存在。例如，自动运行工具可能会引入远程代码执行 (RCE) 等风险，正如一个涉及恶意 MCP 服务器解析 GitHub 文档的概念验证漏洞所证明的那样。为了降低此类风险，MCP 的规范建议禁用自动运行行为并在使用前审计服务器。

### 5.2 信任模型

在多代理系统中建立代理之间的信任至关重要。MCP 的信任模型依赖于：

- **已验证身份**：像 Glama 这样的目录服务会将服务器标记为“官方”或“已验证”，尽管这些标签并不能保证开发人员身份或代码完整性。
- **声誉系统**：新兴的社区驱动的努力，根据可靠性、安全性和性能对 MCP 服务器进行评级。
- **去中心化标识符 (DID)**：MCP 正在探索与 DID 的集成，以实现无需信任的协作，尤其是在开放网络场景中。

然而，信任仍然是一个薄弱环节，因为“已验证”标签可能具有误导性，并且列出的存储库与实际服务器代码之间的偏差很常见。建议开发人员将 MCP 服务器视为具有提升权限的软件包，并在集成前对其进行彻底审计。

### 5.3 服务质量 (QoS)

MCP 通过多种机制解决 QoS 问题：

- **可靠性**：消息确认和重试机制确保可靠交付，尤其是在基于 HTTP SSE 的流式传输中。
- **延迟**：JSON-RPC 的轻量级设计最大限度地减少了开销，而 gRPC 和 WebSocket 支持则降低了高吞吐量场景中的延迟。
- **优先级**：MCP 支持关键任务的消息优先级划分，例如企业工作流程中的实时通知。
- **可伸缩性**：客户端-服务器架构允许 MCP 通过添加更多服务器进行水平扩展，尽管大规模多代理系统中的性能需要进一步评估。

QoS 挑战包括确保分布式系统中的低延迟以及处理高并发场景中的资源争用。需要正在进行的研究来对 MCP 在大规模部署中与 A2A 或 ANP 等协议的性能进行基准测试。

## 6. 互操作性、标准化和生态系统

### 6.1 与异构系统的互操作性

MCP 的模型无关设计使其能够跨不同提供商（例如 Claude、GPT-4、Gemini）和平台（例如 AWS、Azure、Cloudflare）的 LLM 实现互操作性。关键的互操作性功能包括：

- **供应商中立性**：MCP 将工具调用与特定的 LLM 提供商分离，从而允许在模型之间无缝切换。
- **框架集成**：LangChain、Haystack 和 PydanticAI 等库为 MCP 提供即插即用适配器，从而简化了与现有代理框架的集成。
- **跨平台支持**：MCP 服务器可以部署在各种环境中，从本地计算机到 Cloudflare 或 AWS 等云平台。

这种互操作性减少了供应商锁定，并使开发人员能够构建模块化、可维护的系统。

### 6.2 标准化和社区支持

MCP 是一个开放标准，由 Anthropic 根据开源许可证发布，并得到了不断壮大的社区的贡献。OpenAI、Google DeepMind 和微软等主要参与者的采用凸显了其成为 LLM 代理互操作性事实标准的潜力。社区驱动的努力，例如 Glama 的服务器目录以及 Python、TypeScript、Java 和 C# 中的开源 SDK，加速了采用。

然而，对 MCP 文档质量的批评凸显了对更好教育资源的需求。Hacker News 等平台上的帖子将 MCP 描述为“文档记录不佳”，这表明更清晰的规范和教程对于更广泛的采用至关重要。

### 6.3 性能和可伸缩性

MCP 的性能针对单代理工具调用进行了优化，但在大规模多代理系统中面临挑战。基准测试表明，基于 HTTP/SSE 的 JSON-RPC 在中低并发情况下表现良好，但在高吞吐量场景中可能会引入延迟。基于 gRPC 的实现（例如 AgentD）在提高性能方面显示出前景，但关于大规模部署的实际数据有限。

MCP 的无状态设计和对水平扩展的支持增强了可伸缩性。例如，企业部署可以将工作负载分配到多个 MCP 服务器，每个服务器处理特定的工具或资源。然而，在分布式服务器之间管理状态以及确保去中心化网络中的低延迟通信仍然是悬而未决的挑战。

### 6.4 特定领域应用

虽然 MCP 是一种通用协议，但它已应用于不同领域：

- **软件开发**：像 Zed 这样的 IDE 和像 Replit 这样的平台使用 MCP 为编码助手提供实时代码上下文。
- **企业自动化**：像 Block 这样的公司利用 MCP 将内部助手连接到 CRM 系统、知识库和专有文档。
- **自然语言数据访问**：像 AI2SQL 这样的应用程序使用 MCP 来实现针对 SQL 数据库的自然语言查询。
- **桌面助手**：Claude 桌面应用程序运行本地 MCP 服务器以安全地与系统工具交互。
- **Web 开发**：Wix.com 使用 MCP 来实现基于实时数据的人工智能驱动的网站编辑。

这些用例展示了 MCP 的多功能性，尽管特定领域的优化（例如用于机器人技术或供应链管理）仍在不断涌现。

## 7. 与其他协议的比较分析

MCP 是解决 LLM 代理互操作性的几种协议之一，包括代理通信协议 (ACP)、代理间协议 (A2A) 和代理网络协议 (ANP)。比较分析突出了它们的优势和差异：

- **MCP**：专注于工具调用和上下文共享，使用基于 JSON-RPC 的客户端-服务器模型。最适合单代理工作流程和企业集成。
- **ACP**：强调具有多部分消息和异步流式传输的 REST 原生消息传递，支持多模式响应。
- **A2A**：通过基于功能的代理卡实现点对点任务委派，非常适合企业级多代理协调。
- **ANP**：使用 DID 和 JSON-LD 支持去中心化代理发现和协作，面向开放网络场景。

MCP 的优势在于其简单性和供应商中立性，但它缺乏 A2A 强大的多代理协调能力或 ANP 的去中心化发现能力。建议采用分阶段的采用路线图，从用于工具访问的 MCP 开始，然后发展到用于复杂工作流程的 A2A 或 ANP。

## 8. 挑战与未来方向

尽管前景广阔，但 MCP 仍面临一些挑战：

- **文档和可访问性**：文档记录不佳阻碍了开发人员的采用。Anthropic 和社区必须优先考虑全面的指南和教程。
- **安全风险**：诸如提示注入和恶意服务器之类的漏洞需要更强的信任信号和审计机制。
- **可伸缩性**：大规模、去中心化多代理系统中的性能需要进一步评估。
- **语义一致性**：缺乏形式化本体可能会导致异构系统中的模糊性，因此需要可选的本体支持。
- **竞争**：A2A 和 ANP 等协议提供了补充功能，MCP 必须不断发展以保持竞争力。

未来方向包括：

- **增强的传输层**：全面支持 WebSocket 和 gRPC 以提高性能。
- **去中心化发现**：与 DID 和 JSON-LD 集成以实现开放网络兼容性。
- **标准化本体**：可选的本体框架以增强语义一致性。
- **社区参与**：改进文档和 SDK 以推动采用。

## 9. 结论

模型上下文协议 (MCP) 是朝着标准化 LLM 代理交互迈出的变革性一步，为工具调用、上下文共享和互操作性提供了一个与模型无关的、开放标准的框架。其基于 JSON-RPC 的架构、灵活的通信模式和强大的安全功能使其成为单代理和企业工作流程的基础协议。然而，必须解决文档、安全性和可伸缩性方面的挑战，以确保其长期成功。随着 LLM 生态系统的发展，MCP 与 A2A 和 ANP 等新兴协议集成、采用先进传输机制以及促进社区驱动创新的能力将决定其在代理人工智能时代的影响。

## 10. 参考文献

- Saraswathi Lakshman，“MCP 服务器和 AI 代理-LLM 架构”，Medium，2025 年 4 月。
- Emmanuel Mark Ndaliro，“人工智能协议战争：MCP 与 A2A 的综合分析”，Medium，2025 年 5 月。
- “代理互操作性协议综述”，arXiv，2025 年 5 月。
- Shan Chang，“开源代理通信协议比较分析”，Medium，2025 年 3 月。
- “代理互操作性开放协议第 1 部分”，AWS 开源博客，2025 年 5 月。
- “代理互操作性协议综述”，arXiv，2025 年 5 月。
- “下一代互操作性协议深度技术剖析”，MarkTechPost，2025 年 5 月。
- “MCP 和 LLM 安全研究简报”，Wiz 博客，2025 年 4 月。
- “MCP、ACP 和 Agent2Agent 为可扩展的人工智能结果设定标准”，CIO，2025 年 6 月。
- Raghvendra Gupta，“构建支持 MCP 的 AI 代理集成”，Medium，2025 年 4 月。
- “MCP：深入介绍”，Hacker News，2025 年 5 月。
- “人工智能代理协议综述”，arXiv，2025 年 4 月。
- “GitHub - lastmile-ai/mcp-agent”，GitHub，2025 年 1 月。
- “模型上下文协议”，维基百科，2025 年 4 月。
- Abhilash Krishnan，“AgentD：用于多代理 LLM 编排的协议原生服务器”，Medium，2025 年 3 月。
- Fru，“15+ 顶级 MCP 服务器和目录”，Medium，2025 年 4 月。
- “支持 MCP 的 7 大 AI 框架”，GetStream，2025 年 3 月。
- Ksenia Se，“什么是 MCP，为什么每个人都在谈论它？”，Hugging Face，2025 年 3 月。
- “MCP 安全 101：代理人工智能的新协议”，ProtectAI，2025 年 4 月。
- “Agent2Agent (A2A) 协议及其在 2025 年的重要性”，AIMultiple，2025 年 5 月。
- @hylarucoder，X，2025 年 3 月。
- @dotey，X，2025 年 4 月。
- @DailyDoseOfDS_，X，2025 年 5 月。